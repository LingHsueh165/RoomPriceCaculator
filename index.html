<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>å®¿æ³Šæ–™é‡‘è¨ˆç®—</title>
  <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
  <style>
    h1{
      color: #0c5dd7;
    }
    body {
      font-family: sans-serif;
      margin: 2rem;
    }
    label {
      display: block;
      margin-top: 1rem;
      margin-bottom: 1.5rem;
    }
    input, select, button {
      margin-top: 0.5rem;
      padding: 0.4rem;
    }
    button:not(.delete-button) {
      background: linear-gradient(to right, #1976d2, #42a5f5);
      color: white;
      border: 2px solid #1976d2;
      border-radius: 5px;
      margin-bottom: 2rem;
      transition: background 0.3s, border-color 0.3s;
    }
    button:not(.delete-button):hover {
      background: linear-gradient(to right, #1565c0, #1e88e5);
      border-color: #0d47a1;
      cursor: pointer;
    }
    #new_room {  /* è¿½åŠ ãƒœã‚¿ãƒ³ */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      background: #449bff;
      border: none;
      border-radius: 3px;
      margin-bottom: 0.5rem;
    }
    #new_room:hover {
      background: #1e6dc6;
      border: none;
      border-radius: 3px;
      margin-bottom: 0.5rem;
    }
    .delete-button {  /* å‰Šé™¤ãƒœã‚¿ãƒ³ */
      background-color: #e53935;
      color: white;
      border: none;
      margin-top: 1rem;
      padding: 0.3rem 0.6rem;
      border-radius: 3px;
      font-size: 0.9rem;
      align-self: flex-end;
    }
    .delete-button:hover {
      background-color: #c62828;
      cursor: pointer;
    }
    .room {  /* éƒ¨å±‹ã”ã¨ä¸€ã¤ã®ãƒœãƒƒã‚¯ã‚¹ã«å…¥ã‚Œã‚‹ */
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      position: relative;
      margin-bottom: 0.5rem;
      padding: 1rem;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #fafafa;
      transition: background-color 0.3s;
    }
    .room:hover {
      background-color: #e9f3ff;
    }
    .room-row {
      display: flex;
      gap: 1rem;
      align-items: flex-end;
      flex-wrap: wrap;
    }
    .room-row label {
      flex-grow: 1;
    }
    .child-options {  /* Aï½Dã¾ã§ã®å…¥åŠ›ãƒãƒ¼ */
      display: flex;
      gap: 3rem;
      flex-wrap: wrap;
      align-items: flex-end;
    }
    .child-options label {
      box-sizing: border-box;
      display: flex;
      align-items: center;
      gap: 1rem;
      white-space: nowrap;
    }
    .child-options input[type="number"] {
      width: 7rem;
    }
    #result {  /* è¨ˆç®—çµæœã®ãƒ–ãƒ­ãƒƒã‚¯ */
      margin-top: 2rem;
      border-top: 1px solid #ccc;
      padding-top: 1rem;
    }
    #result:hover {
      background-color: #f1f8ff;
      transition: background-color 0.3s;
    }
    .hidden {
      display: none;
    }
    details summary {
      cursor: pointer;
      font-weight: bold;
    }
    details[open] summary::after {
      content: " â–²";
    }
    summary::after {
      content: " â–¼";
      margin-left: 0.5em;
    }
    pre {
      white-space: pre-wrap;
      background-color: #f9f9f9;
      padding: 1rem;
      border-radius: 5px;
      line-height: 1.6;
    }
  </style>
</head>
<body>
  <h1>å®¿æ³Šæ–™é‡‘è©¦ç®—ãƒ„ãƒ¼ãƒ«</h1>

  <label>æ–™é‡‘è¡¨ï¼š
    <select id="guestType" onchange="loadPriceTable()">
      <option value="jp">æ—¥æœ¬äºº</option>
      <option value="en">å¤–å›½äºº</option>
      <option value="wedding">å©šç¤¼ã‚²ã‚¹ãƒˆ</option>
    </select>
  </label>  

  <label>
    ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ—¥ï¼š<br>
    <input type="date" id="checkInDate" value="">
  </label>

  <label>
    æ³Šæ•°ï¼š<br>
    <input type="number" id="nights" min="1" value="1">
  </label>

  <div id="roomsContainer">
    <div class="room">
      <div class="room-row">
        <label>
          ãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—ï¼š<br>
          <select class="room-type" onchange="updateRoomCapacity(this)">
            <option value="ãƒ„ã‚¤ãƒ³">ãƒ„ã‚¤ãƒ³</option>
            <option value="ã‚°ãƒ©ãƒ³ãƒ“ãƒ¥ãƒ¼">ã‚°ãƒ©ãƒ³ãƒ“ãƒ¥ãƒ¼</option>
            <option value="ç´°æµäº­ãƒ¢å’Œå®¤">ç´°æµäº­ãƒ¢å’Œå®¤</option>
            <option value="ç´°æµäº­å’Œãƒ„ã‚¤">ç´°æµäº­å’Œãƒ„ã‚¤</option>
            <option value="æ·±å±±äº­4ï½8éš">æ·±å±±äº­4ï½8éš</option>
            <option value="æ·±å±±äº­1ï½3éš">æ·±å±±äº­1ï½3éš</option>
            <option value="æ¡‚äº­(æ·±å±±äº­Géš)">æ¡‚äº­(æ·±å±±äº­Géš)</option>
            <option value="å­æ¥½">å­æ¥½</option>
            <option value="é‡æ¥½ãƒ»è©±æ¥½ãƒ»æ¹¯è©±">é‡æ¥½ãƒ»è©±æ¥½ãƒ»æ¹¯è©±</option>
            <option value="ç‡¦é‡ŒComfort">ç‡¦é‡ŒComfort</option>
            <option value="ç‡¦é‡ŒSuite">ç‡¦é‡ŒSuite</option>
            <option value="ç¦åœ°A">ç¦åœ°A</option>
            <option value="ç¦åœ°B">ç¦åœ°B</option>
            <option value="æ˜è¦‹A">æ˜è¦‹A</option>
            <option value="æ˜è¦‹B">æ˜è¦‹B</option>
            <option value="ç‘ç©‚">ç‘ç©‚</option>
            <option value="è²´è³“å®¤">è²´è³“å®¤</option>
          </select>
        </label>
        <label>
          å¤§äººï¼š<br>
          <input type="number" class="adult-count" min="0" value="2">
        </label>
        <label class="meal-plan hidden">
          ãƒ—ãƒ©ãƒ³ï¼š<br>
          <select class="meal-select">
            <option value="ï¼‘æ³Šï¼’é£Ÿä»˜">ï¼‘æ³Šï¼’é£Ÿä»˜</option>
            <option value="ï¼‘æ³Šæœé£Ÿä»˜">ï¼‘æ³Šæœé£Ÿä»˜</option>
          </select>
        </label>
        <label class="sasa-plan hidden">
          ãƒ—ãƒ©ãƒ³ï¼š
          <select class="sasa-select">
            <option value="qua-plan">QUALITYãƒ—ãƒ©ãƒ³</option>
            <option value="anni-plan">SASA-ANNIVERSARYãƒ—ãƒ©ãƒ³</option>
          </select>
        </label>
        <label class="kihin-plan hidden">
          ãƒ—ãƒ©ãƒ³ï¼š
          <select class="kihin-select">
            <option value="no-plan">ãªã—</option>
            <option value="PRanni-plan">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¢ãƒ‹ãƒãƒ¼ã‚µãƒªãƒ¼</option>
          </select>
        </label>
        <br>
      </div>
      <div class="child-options">
        <label>A. å°å­¦ç”Ÿã€€ï¼š<input type="number" class="child-a" min="0" value="0"></label>
        <label>B. å¹¼å…ã€€ã€€ï¼š<input type="number" class="child-b" min="0" value="0"></label>
        <label>C. å¯å…·ã®ã¿ï¼š<input type="number" class="child-c" min="0" value="0"></label>
        <label>D. ä¹³å…ã€€ã€€ï¼š<input type="number" class="child-d" min="0" value="0"></label>
      </div>
    </div>
  </div>

  <button id="new_room" onclick="newRoom()">è¿½åŠ </button>
  <div><br></div>
  <button onclick="calculatePrice()">è¨ˆç®—</button>
  <button onclick="clearAllContent()">ãƒªã‚»ãƒƒãƒˆ</button>

  <div id="result" class="hidden">
    <h2>è¨ˆç®—çµæœ</h2>
    <p id="totalPrice">ç·é¡ï¼š- å††</p>
    <details>
      <summary>ğŸ“‹ æ–™é‡‘å†…è¨³ï¼ˆã‚¯ãƒªãƒƒã‚¯ã—ã¦ï¼ï¼‰</summary>
      <pre id="calculationLog"></pre>
    </details>
  </div>

  <script src="priceCalendar_2025.js"></script>

  <script>
    const capacityLimit = {
      "ãƒ„ã‚¤ãƒ³": 2,
      "ã‚°ãƒ©ãƒ³ãƒ“ãƒ¥ãƒ¼": 3,
      "ç´°æµäº­ãƒ¢å’Œå®¤": 3,
      "ç´°æµäº­å’Œãƒ„ã‚¤": 3,
      "å­æ¥½": 2,
      "ç‡¦é‡ŒSuite": 5,
      "ç¦åœ°A": 5,
      "ç¦åœ°B": 5,
      "æ˜è¦‹A": 2,
      "æ˜è¦‹B": 2,
      "ç‘ç©‚": 3,
    }; /* å„éƒ¨å±‹ã‚¿ã‚¤ãƒ—ã®äººæ•°ä¸Šé™ */

    function updateRoomCapacity(selectElement) {  /* éƒ¨å±‹ã‚¿ã‚¤ãƒ—ã‚’å¤‰æ›´ã™ã‚‹æ™‚äººæ•°ä¸Šé™ã‚’åŒæ™‚ã«æ›´æ–° */
      const roomBlock = selectElement.closest('.room');
      const adultInput = roomBlock.querySelector('.adult-count');
      const selectedRoom = selectElement.value;
      const sasaPlan = roomBlock.querySelector(".sasa-select")?.value;
      let capacity = 5;

      adultInput.max = capacity;
      if (sasaPlan === "anni-plan") {
      	capacity = 2;
      } 
      else {
      	capacity = capacityLimit[selectedRoom] || 5;
      }

      adultInput.max = capacity;
      if (parseInt(adultInput.value) > capacity) {
      	adultInput.value = capacity;
      	alert('å®¿æ³Šäººæ•°ã‚ªãƒ¼ãƒãƒ¼ï¼');
      }
      adultInput.oninput = () => {
        if (parseInt(adultInput.value) > capacity) {
          adultInput.value = capacity;
          alert('å®¿æ³Šäººæ•°ã‚ªãƒ¼ãƒãƒ¼ï¼');
        }
      };
      upadateSasaPlanVisibility();
      hideBedOnlyOption();
    }

    function updateMealPlanVisibility() { /* å©šç¤¼ã‚²ã‚¹ãƒˆã«å¤‰æ›´ã™ã‚‹æ™‚ã€Œæœé£Ÿã®ã¿ã€ã®é¸æŠè‚¢ã‚’å‡ºã™ */
      const guestType = document.getElementById("guestType").value;
      
      const isWedding = guestType === "wedding";
      document.querySelectorAll(".meal-plan").forEach(label => {
        label.classList.toggle("hidden", !isWedding);
      });
    }

    function upadateSasaPlanVisibility() {  /* ã•ã•ã®éƒ¨å±‹ã«å¤‰æ›´ã™ã‚‹æ™‚ã€Œãƒ—ãƒ©ãƒ³ã€ã®é¸æŠè‚¢ã‚’å‡ºã™ */
      const guestType = document.getElementById("guestType").value;

      document.querySelectorAll(".room").forEach(room => {
        const roomType = room.querySelector(".room-type")?.value;
        const sasaPlanLabel = room.querySelector(".sasa-plan");
        const sasaRoom = ["ç¦åœ°A", "ç¦åœ°B", "æ˜è¦‹A", "æ˜è¦‹B", "ç‘ç©‚"];

        if (roomType && sasaPlanLabel) {
          const shouldShow = guestType === "jp" && sasaRoom.includes(roomType);
          sasaPlanLabel.classList.toggle("hidden", !shouldShow);
        }
      });
    }

    function hideBedOnlyOption(){ /* ç‡¦é‡Œï½è²´è³“å®¤ã®éƒ¨å±‹ã¯ã€Œå¯å…·ã®ã¿ã€ã®é¸æŠè‚¢ã‚’éè¡¨ç¤º */
      const guestType = document.getElementById("guestType").value;

      document.querySelectorAll(".room").forEach(room => {
        const roomType = room.querySelector(".room-type")?.value;
        const noBedOnlyRoom = ["ç¦åœ°A", "ç¦åœ°B", "æ˜è¦‹A", "æ˜è¦‹B", "ç‘ç©‚", "è²´è³“å®¤"];
        const childCOption = room.querySelector('.child-options label:nth-child(3)');

        if (noBedOnlyRoom.includes(roomType)){
          childCOption.style.display = 'none';
        }
        else {
          childCOption.style.display = 'block';
        }
      });
    }

    function updateRoomTypeOptions(guestType) { /* å©šç¤¼ã‚²ã‚¹ãƒˆã«å¤‰æ›´ã™ã‚‹æ™‚é¸æŠã§ãã‚‹éƒ¨å±‹ã‚¿ã‚¤ãƒ—ã‚’åŒæ™‚ã«æ›´æ–° */
      const roomTypeSelects = document.querySelectorAll('.room-type');

      roomTypeSelects.forEach(select => {
        const selectedValue = select.value;
        select.innerHTML = '';  // å…ƒã®é¸æŠè‚¢ã‚’ã‚¯ãƒªã‚¢

        const roomOptions = guestType === 'wedding'
          ? Object.keys(window.priceTable)  // å©šç¤¼ã‚²ã‚¹ãƒˆã®å€¤æ®µè¡¨ã«ã‚ã‚‹éƒ¨å±‹ã‚¿ã‚¤ãƒ—ã®ã¿ä¿ç•™
          : [
              "ãƒ„ã‚¤ãƒ³", "ã‚°ãƒ©ãƒ³ãƒ“ãƒ¥ãƒ¼", "ç´°æµäº­ãƒ¢å’Œå®¤", "ç´°æµäº­å’Œãƒ„ã‚¤", "æ·±å±±äº­4ï½8éš", "æ·±å±±äº­1ï½3éš",
              "æ¡‚äº­(æ·±å±±äº­Géš)", "å­æ¥½", "é‡æ¥½ãƒ»è©±æ¥½ãƒ»æ¹¯è©±", "ç‡¦é‡ŒComfort", "ç‡¦é‡ŒSuite",
              "ç¦åœ°A", "ç¦åœ°B", "æ˜è¦‹A", "æ˜è¦‹B", "ç‘ç©‚", "è²´è³“å®¤"
            ];

        roomOptions.forEach(room => {
          const option = document.createElement('option');
          option.value = room;
          option.textContent = room;
          select.appendChild(option);
        });

        // å…ƒã®é¸æŠè‚¢ã¯æ–°ã—ã„ãƒªã‚¹ãƒˆã«ã‚ã‚‹å ´åˆã‚‚ä¿ç•™
        if (roomOptions.includes(selectedValue)) {
          select.value = selectedValue;
        }
      });
    }

    function loadPriceTable() { /* ãŠå®¢æ§˜ã®ç¨®é¡ã«ã‚ˆã£ã¦å€¤æ®µè¡¨ã‚’èª­ã¿è¾¼ã‚€ */
      const guestType = document.getElementById("guestType").value;

      delete window.priceTable; // å…ƒã®priceTableã‚’ã‚¯ãƒªã‚¢ï¼ˆå…ƒã®ãƒ‡ãƒ¼ã‚¿ãŒæ®‹ã™ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ã‹ã‚‚ï¼‰
      // å…ƒã®scriptã‚‚å‰Šé™¤ï¼ˆå†èª­ã¿è¾¼ã¿ã‚’æ§ãˆï¼‰
      const oldScript = document.getElementById("priceTableScript");
      if (oldScript) {
        oldScript.remove();
      }

      // æ–°ã—ã„scriptã‚’è¿½åŠ 
      const script = document.createElement("script");
      script.src = `priceData_${guestType}.js`;
      script.id = "priceTableScript"; // â† æ¬¡å›ä»¥é™ã¯ã“ã‚Œã§å‰Šé™¤ã®åˆ¤æ–­ã«ä½¿ã†
      script.onload = () => {
        updateRoomTypeOptions(guestType); // âœ… ã“ã“ã«è¿½åŠ 
        updateMealPlanVisibility();       // âœ… ã€Œæœé£Ÿã®ã¿ã€ã®é¸æŠè‚¢ã‚‚ã“ã“ã§å‘¼ã¶
        upadateSasaPlanVisibility();
        hideBedOnlyOption();

        // å©šç¤¼ã‚²ã‚¹ãƒˆã¯ä¸€æ³Šã®ã¿
        const nightsInput = document.getElementById("nights");
        if (guestType === "wedding"){
          nightsInput.max = 1;
          if (parseInt(nightsInput.value) > 1){
              nightsInput.max = 1;
          }
        }
        else {
          nightsInput.removeAttribute("max");
        }
      };
      document.head.appendChild(script);
    }

    function getPeopleCountKey(adults, roomType, mealPlan = null, sasaPlan = null) {  /* å®¿æ³Šäººæ•°ã®ã‚­ãƒ¼ã‚’èª­ã¿è¾¼ã‚€ï¼ˆå€¤æ®µåˆ¤æ–­ã«ä½¿ã†ï¼‰ */
      let dataLevel = window.priceTable[roomType];

      if (sasaPlan && dataLevel?.[sasaPlan]) {
      	dataLevel = dataLevel[sasaPlan];
      } 
      else if (mealPlan && dataLevel?.[mealPlan]) {
      	dataLevel = dataLevel[mealPlan];
      }
	
      const keys = Object.keys(dataLevel || {});
      console.log(`ğŸ” äººæ•°ã‚­ãƒ¼ç¢ºèª: ${roomType} / ${mealPlan} / ${sasaPlan} â†’ é¸æŠè‚¢:`, keys);
      
      const key = `${adults}å`;
      if (keys.includes(key)) return key;

      for (let i = adults; i >= 2; i--) {
      	const fallback = `${i}åä»¥ä¸Š`;
      	if (keys.includes(fallback)) return fallback;
      }

      console.warn(`âš ï¸ äººæ•°ã‚­ãƒ¼è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: ${roomType} / ${mealPlan} / ${sasaPlan} / ${adults}å`);
      return null;
    }

    function newRoom() {  /* éƒ¨å±‹è¿½åŠ  */
      const container = document.getElementById("roomsContainer");
      const newDiv = document.createElement("div");
      newDiv.classList.add("room");
      newDiv.innerHTML = `
          <div class="room-row">
            <label>
            ãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—ï¼š<br>
            <select class="room-type" onchange="updateRoomCapacity(this)">
              <option value="ãƒ„ã‚¤ãƒ³">ãƒ„ã‚¤ãƒ³</option>
              <option value="ã‚°ãƒ©ãƒ³ãƒ“ãƒ¥ãƒ¼">ã‚°ãƒ©ãƒ³ãƒ“ãƒ¥ãƒ¼</option>
              <option value="ç´°æµäº­ãƒ¢å’Œå®¤">ç´°æµäº­ãƒ¢å’Œå®¤</option>
              <option value="ç´°æµäº­å’Œãƒ„ã‚¤">ç´°æµäº­å’Œãƒ„ã‚¤</option>
              <option value="æ·±å±±äº­4ï½8éš">æ·±å±±äº­4ï½8éš</option>
              <option value="æ·±å±±äº­1ï½3éš">æ·±å±±äº­1ï½3éš</option>
              <option value="æ¡‚äº­(æ·±å±±äº­Géš)">æ¡‚äº­(æ·±å±±äº­Géš)</option>
              <option value="å­æ¥½">å­æ¥½</option>
              <option value="é‡æ¥½ãƒ»è©±æ¥½ãƒ»æ¹¯è©±">é‡æ¥½ãƒ»è©±æ¥½ãƒ»æ¹¯è©±</option>
              <option value="ç‡¦é‡ŒComfort">ç‡¦é‡ŒComfort</option>
              <option value="ç‡¦é‡ŒSuite">ç‡¦é‡ŒSuite</option>
              <option value="ç¦åœ°A">ç¦åœ°A</option>
              <option value="ç¦åœ°B">ç¦åœ°B</option>
              <option value="æ˜è¦‹A">æ˜è¦‹A</option>
              <option value="æ˜è¦‹B">æ˜è¦‹B</option>
              <option value="ç‘ç©‚">ç‘ç©‚</option>
              <option value="è²´è³“å®¤">è²´è³“å®¤</option>
            </select>
          </label>
          <label>
            å¤§äººï¼š<br>
            <input type="number" class="adult-count" min="0" value="2">
          </label>
          <label class="meal-plan hidden">
            ãƒ—ãƒ©ãƒ³ï¼š<br>
            <select class="meal-select">
              <option value="ï¼‘æ³Šï¼’é£Ÿä»˜">ï¼‘æ³Šï¼’é£Ÿä»˜</option>
              <option value="ï¼‘æ³Šæœé£Ÿä»˜">ï¼‘æ³Šæœé£Ÿä»˜</option>
            </select>
          </label>
          <label class="sasa-plan hidden">
            ãƒ—ãƒ©ãƒ³ï¼š
            <select class="sasa-select">
              <option value="qua-plan">QUALITYãƒ—ãƒ©ãƒ³</option>
              <option value="anni-plan">SASA-ANNIVERSARYãƒ—ãƒ©ãƒ³</option>
            </select>
         </label>
         <label class="kihin-plan hidden">
          ãƒ—ãƒ©ãƒ³ï¼š
          <select class="kihin-select">
            <option value="no-plan">ãªã—</option>
            <option value="PRanni-plan">ãƒ—ãƒ¬ãƒŸã‚¢ãƒ ã‚¢ãƒ‹ãƒãƒ¼ã‚µãƒªãƒ¼</option>
          </select>
        </label>
          <br>
        </div>
        <div class="child-options">
          <label>A. å°å­¦ç”Ÿã€€ï¼š<input type="number" class="child-a" min="0" value="0"></label>
          <label>B. å¹¼å…ã€€ã€€ï¼š<input type="number" class="child-b" min="0" value="0"></label>
          <label>C. å¯å…·ã®ã¿ï¼š<input type="number" class="child-c" min="0" value="0"></label>
          <label>D. ä¹³å…ã€€ã€€ï¼š<input type="number" class="child-d" min="0" value="0"></label>
        </div>
        <button class="delete-button" onclick="deleteRoom(this)">å‰Šé™¤</button>
      `;
      container.appendChild(newDiv);
      updateRoomCapacity(newDiv.querySelector('.room-type'));
      updateRoomTypeOptions(document.getElementById("guestType").value);
      updateMealPlanVisibility();
      upadateSasaPlanVisibility();
      hideBedOnlyOption();
    }

    function deleteRoom(button) { /* éƒ¨å±‹è¿½åŠ  */
      const roomDiv = button.closest(".room");
      roomDiv.remove();
    }

    function setDefaultDate() { /* ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®æ—¥ä»˜ã‚’å½“æ—¥ã®æ—¥ä»˜ã«ã™ã‚‹ */
      const getToday = new Date();
      const y = getToday.getFullYear();
      const m = getToday.getMonth() + 1;
      const d = getToday.getDate();
      const today = y + "-" + m.toString().padStart(2,'0') + "-" + d.toString().padStart(2,'0');
      document.getElementById("checkInDate").setAttribute("value",today);
    }

    function calculatePrice() { /* æ–™é‡‘è¨ˆç®— */
      const guestType = document.getElementById("guestType").value;
      const date = document.getElementById('checkInDate').value;
      const nights = parseInt(document.getElementById('nights').value);
      const mealPlans = document.querySelectorAll(".meal-select");
      const sasaPlans = document.querySelectorAll(".sasa-select");
      const roomTypes = document.querySelectorAll('.room-type');
      const adultCounts = document.querySelectorAll('.adult-count');
      const childAInputs = document.querySelectorAll('.child-a');
      const childBInputs = document.querySelectorAll('.child-b');
      const childCInputs = document.querySelectorAll('.child-c');
      const childDInputs = document.querySelectorAll('.child-d');

      /*  */
      let total = 0;
      let log = `ğŸ¨ å®¿æ³Šæƒ…å ±\n`;
      log += `ğŸ“… ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³æ—¥ï¼š${date}\n`;
      log += `ğŸŒ™ æ³Šæ•°ï¼š${nights} æ³Š\n`;

      for (let i = 0; i < roomTypes.length; i++) {        
        const adults = parseInt(adultCounts[i].value) || 0;
        const childrenA = parseInt(childAInputs[i]?.value) || 0;
        const childrenB = parseInt(childBInputs[i]?.value) || 0;
        const childrenC = parseInt(childCInputs[i]?.value) || 0;
        const childrenD = parseInt(childDInputs[i]?.value) || 0;
        const roomType = roomTypes[i].value;    
        const mealPlan = guestType === "wedding"
          ? mealPlans[i]?.value        // ã€Œå©šç¤¼ã‚²ã‚¹ãƒˆã€ã®ã¿ã“ã‚Œã‚’ä½¿ã†
          : null;              // ä»–ã¯ã“ã‚Œã‚’ä½¿ã†
        const sasaPlan = sasaPlans[i]?.closest(".sasa-plan")?.classList.contains("hidden") ? null : sasaPlans[i]?.value;
        const peopleCount = getPeopleCountKey(adults, roomType, mealPlan, sasaPlan);
        const checkInDate = new Date(date);
        const dateKey = checkInDate.toISOString().split("T")[0];
        const seasonKey = window.priceCalendar[dateKey] || "å¹³æ—¥"; // ãªã—ã®å ´åˆã‚’å¹³æ—¥æ‰±ã„
        console.log(`ğŸ“… å®¿æ³Šæ—¥ï¼š${dateKey}ï¼ˆåˆ†é¡ï¼š${seasonKey}ï¼‰`);
        const basePrice = sasaPlan
          ? priceTable[roomType]?.[sasaPlan]?.[peopleCount]?.[seasonKey]
          : guestType === "wedding"
            ? priceTable[roomType]?.[mealPlan]?.[peopleCount]?.[seasonKey]
            : priceTable[roomType]?.[peopleCount]?.[seasonKey];   
        
        if (roomTypes.length === 0) {
          alert('éƒ¨å±‹ã‚’è¿½åŠ ã—ã¦ãã ã•ã„ï¼');
          return;
        };
        if (adults > capacityLimit[roomType]) {
          log += `âŒ éƒ¨å±‹ ${i + 1}ï¼š${roomType} ã¯äººæ•°ã‚ªãƒ¼ãƒãƒ¼ã—ã¾ã—ãŸï¼ˆæœ€å¤§å¤§äºº ${capacityLimit[roomType]} åï¼‰\n`;
          log += `-----------------------------------\n`;
          continue;
        }
        
        console.log(peopleCount);
        if (!peopleCount){
            log += `âš ï¸ å¯¾å¿œã™ã‚‹æ–™é‡‘ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼`
            continue;
        }  
        if (!basePrice) {
          log += `âš ï¸ éƒ¨å±‹ ${i + 1}ï¼šå¯¾å¿œã™ã‚‹æ–™é‡‘ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ï¼ ${roomType}ï¼${mealPlan}ï¼${peopleCount}ï¼${seasonKey} \n`;
          log += `-----------------------------------\n`;
          continue;
        }

        let totalBeforeTax = basePrice * nights * adults;
        totalBeforeTax += basePrice * nights * 0.7 * childrenA;
        totalBeforeTax += basePrice * nights * 0.5 * childrenB;

        // âš ï¸ Cï¼šãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—åˆ¶é™ã‚ã‚Š
        const disallowedForC = ["è²´è³“å®¤", "ç¦åœ°A", "ç¦åœ°B", "æ˜è¦‹A", "æ˜è¦‹B", "ç‘ç©‚"];
        if (!disallowedForC.includes(roomType)) {
          totalBeforeTax += basePrice * nights * 0.3 * childrenC;
        }

        // âš ï¸ Dï¼šæ–™é‡‘è¡¨ä¸è¦ãªè¨ˆç®—
        const premiumForD = ["ç‡¦é‡ŒComfort", "ç‡¦é‡ŒSuite", "è²´è³“å®¤", "ç¦åœ°A", "ç¦åœ°B", "æ˜è¦‹A", "æ˜è¦‹B", "ç‘ç©‚"];
        let babyUnit = premiumForD.includes(roomType) ? 8000 : 5000;
        if (seasonKey === "å¹´æœ«å¹´å§‹") {
          babyUnit = premiumForD.includes(roomType) ? 10000 : 6000;
        }
        totalBeforeTax += babyUnit * nights * childrenD;

        const tax = totalBeforeTax * 0.1;
        const bathingTax = adults * 150 * nights;
        const roomTotal = Math.round(totalBeforeTax + tax + bathingTax);
        total += roomTotal;

        log += `ğŸ›ï¸ éƒ¨å±‹ ${i + 1}\n`;
        log += `ãƒ»ãƒ«ãƒ¼ãƒ ã‚¿ã‚¤ãƒ—ï¼š${roomType}\n`;
        log += `ãƒ»å¤§äººï¼š${adults} å\n`;
        log += `ãƒ»å­ä¾›æ˜ç´°ï¼šå°å­¦ç”Ÿ ${childrenA}ã€å¹¼å… ${childrenB}ã€å¯å…·ã®ã¿ ${childrenC}ã€ä¹³å… ${childrenD}\n`;
        log += `ãƒ»æ¡ä»¶ï¼š${peopleCount}ï½œ${seasonKey}ï½œä¸€æ³Š Â¥${basePrice} å††\n`;
        log += `ãƒ»æ–™é‡‘å†…è¨³ï¼š\n`;
        log += `  ã€€ã€€ã€€å¤§äºº Ã— ${adults} å\n`;
        log += `  ã€€ã€€ã€€å°å­¦ç”Ÿ Ã— ${childrenA} åï¼ˆ70%ï¼‰\n`;
        log += `  ã€€ã€€ã€€å¹¼å… Ã— ${childrenB} åï¼ˆ50%ï¼‰\n`;
        log += `  ã€€ã€€ã€€å¯å…·ã®ã¿ Ã— ${childrenC} åï¼ˆ30%ï¼‰\n`;
        log += `  ã€€ã€€ã€€ä¹³å… Ã— ${childrenD} åï¼ˆå›ºå®š ${babyUnit} å††ï¼‰\n`;
        log += `ãƒ»æ–™é‡‘ï¼šÂ¥${Math.round(totalBeforeTax)}\n`;
        log += `ãƒ»æ¶ˆè²»ç¨ï¼ˆ10%ï¼‰ï¼šÂ¥${Math.round(tax)}\n`;
        log += `ãƒ»å…¥æ¹¯ç¨ï¼šÂ¥${bathingTax}\n`;
        log += `ãƒ»ç·é¡ï¼šÂ¥${roomTotal}\n`;
        log += `-----------------------------------\n`;
      }

      log += `âœ… åˆè¨ˆï¼šÂ¥${total.toLocaleString()}`;
      document.getElementById('totalPrice').textContent = `âœ… åˆè¨ˆæ–™é‡‘ï¼šÂ¥${total.toLocaleString()} å††`;
      document.getElementById('calculationLog').textContent = log;
      document.getElementById('result').classList.remove('hidden');
      document.getElementById('result').scrollIntoView({ behavior: 'smooth' });
    }

    function clearAllContent(){ /* å…¥åŠ›å†…å®¹ã‚’ã‚¯ãƒªã‚¢ */
      //document.getElementById('checkInDate').value = "";
      setDefaultDate();
      document.getElementById("nights").value = 1;
      document.getElementById("result").classList.add("hidden");
      document.getElementById("guestType").value = "jp";
      const container = document.getElementById("roomsContainer");
      container.innerHTML = "";
      newRoom();

      loadPriceTable();
      updateRoomTypeOptions("jp");
      updateMealPlanVisibility();
      upadateSasaPlanVisibility();
      hideBedOnlyOption();
    }

    // âœ… ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
    window.addEventListener('DOMContentLoaded', () => {
      const firstSelect = document.querySelector('.room-type');

      if (firstSelect) {
        updateRoomCapacity(firstSelect);
      }
      loadPriceTable();
      setDefaultDate();
    });

  </script>
</body>
</html>

